#+TITLE: libvirt
#+FILETAGS: libvirt kvm qemu
#+SETUPFILE: .setup.org

* Remote setup with NixOS
:PROPERTIES:
:CUSTOM_ID: h:348103fa-e9a6-49b0-a7f8-7b212d647940
:END:

Usually, you connect to =libvirt= using =qmeu:///system= or =qemu+ssh://â€¦=. This works in
most case but sometimes you want to expose libvirt on tcp (with or without TLS). One such
example is for [[https://github.com/openshift/installer/][=openshift/installer=]].

#+begin_src nix
  boot.kernel.sysctl = { "net.ipv4.ip_forward" = 1 ; };
  virtualisation.libvirtd = {
    extraConfig = ''
    listen_tls = 0
    listen_tcp = 1
    auth_tcp="none"
    tcp_port = "16509"
    '';
    extraOptions = [ "--listen" ]
  };
  networking.firewall.allowedTCPPorts = [ 16509 ];
#+end_src

For =openshift= purpose we may want dns entry like =echo
server=/tt.testing/192.168.126.1 | sudo tee /etc/NetworkManager/dnsmasq.d/openshift.conf=.

** Sources
:PROPERTIES:
:CUSTOM_ID: h:6b85c514-d810-4441-89f1-133158f17761
:END:
- [[https://github.com/openshift/installer/blob/master/docs/dev/libvirt-howto.md][=openshift/installer= libvirt HOWTO]]
- [[https://libvirt.org/remote.html][libvirt: Remote support]]
- [[https://libvirt.org/auth.html][libvirt: Connection authentication]]
- [[https://libvirt.org/remote.html][libvirt: Remote support]]
